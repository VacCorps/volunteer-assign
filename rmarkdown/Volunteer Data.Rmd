---
title: "Volunteer Data"
author: "Salil N. Pendse"
date: "2/15/2021"
output: powerpoint_presentation
always_allow_html: true
---

```{r setup,echo = F, include=FALSE}
knitr::opts_knit$set(root.dir = normalizePath("../"))

library(ggplot2)
library(mapproj)
library(broom)
library(geojsonio)
library(tidyverse)
library(magrittr)
library(lubridate)
library(geosphere)
library(rstudioapi)

#read the us zip data
zip_data <- read_delim("../Database/us-zip-code-latitude-and-longitude.csv",delim = ";") %>%
  select("Zip","State","Latitude","Longitude") %>%
  mutate(longlat = map2(Longitude,Latitude,c),
         Latitude = NULL,
         Longitude = NULL) %>%
  rename(zip = Zip)

# Replace the file path with the location of the most recent download
file_path <- "C:/Users/spendse/Projects/VacCorps developement/wpforms-81-Volunteer-Registration-2021-02-15-22-28-22.csv"
vt_base <- read_csv(file_path,skip = 1,
                    col_names = c("roles","certified","lang","more.lang",
                                                     "hours","days","community","distance",
                                                     "vaccine","exp","cv","name","email",
                                                     "phone","zip","age_consent", "about",
                                                     "waiver","entryid","uid")) %>%
  drop_na(uid) %>%
  mutate(vtID = paste0("vt",row_number()))


# get the roles NC volunteers are choosing
vt_nc_roles_count <- vt_base %>% 
  select("roles","zip","vtID") %>%
  full_join(zip_data,"zip") %>% 
  filter(State == "NC") %>%
  drop_na() %>%  
  select("vtID","roles") %>% 
  pmap_dfr(~set_names(str_split(..2,"\n"),..1)) %>% 
  pivot_longer(cols = starts_with("vt"),names_to = "vtID",values_to= "role") %>%
  drop_na(role) %>% 
  group_by(role) %>% 
  count

# Get the geojson for the nc county data
shape_data <- geojson_read("https://opendata.arcgis.com/datasets/d192da4d0ac249fa9584109b1d626286_0.geojson",what = "sp")
# reformat to dataframe by using county names as id
shape_data <- tidy(shape_data,region = "CountyName")

# get the Zip code to count
zip_county_data <- read_csv("../Database/NC_zip_county.csv",skip = 1, col_types = c("c","c"),col_names = c("zip","county"))

vt_county_data <- vt_base %>% 
  select("vtID","zip") %>% 
  full_join(zip_county_data,by = "zip") %>%
  group_by(county) %>% 
  count %>% 
  drop_na
```

## Volunteer preferred roles in NC

```{r role_tble, echo  = F}
vt_nc_roles_count %>%
  knitr::kable(col.names = c("Roles","Number of Volunteers"))

```

## NC Volunteers by county data

```{r echo = F}
knitr::kable(vt_county_data,col.names = c("County","Number of volunteers"))
```

## NC Volunteers by county map

```{r pressure, echo = F} 
knitr::opts_chunk$set(fig.width = 24,fig.height = 16)
shape_data_combined <- shape_data %>% left_join(vt_county_data, by = c("id"="county"))
ggplot() +
  geom_polygon(data = shape_data_combined, aes(fill = n, x = long, y = lat, group = group)) +theme_void()+
  coord_map() +
  scale_fill_distiller(name="Number",palette = "YlGnBu",direction = 1)
  # scale_fill_continuous( low = "lightblue", 
  #           high = "darkblue", 
  #           na.value = "grey50")
```

